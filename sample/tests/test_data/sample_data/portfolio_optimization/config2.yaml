# Portfolio Optimization Configuration
# Tax-efficient stock liquidation with configurable constraints and objectives

# Model metadata
model_name: "stock_liquidation_tax_optimization"
model_id: "PORT_OPT_001"
submission_id: "SUB_20250115_001"
model_type: "milp"

# Playbook type
playbook_type: "portfolio_optimization"

# Dataset paths
datasets:
  holdings: "tests/test_data/sample_data/portfolio_optimization/holdings.csv"
  acquisitions: "tests/test_data/sample_data/portfolio_optimization/purchase_history.csv"

# Column mappings (map config names to actual CSV column names)
columns:
  ticker: "ticker"
  shares_held: "shares_held"
  current_price: "current_price"
  total_value: "total_value"
  acquisition_date: "acquisition_date"
  purchase_price: "purchase_price"
  shares_purchased: "shares_purchased"

# Constraints configuration
constraints:
  - name: "liquidate_all_holdings"
    type: "equality"
    description: "Must sell all externally held shares"
    # This will be auto-generated per ticker in code

  # Add custom constraints if needed
  # - name: "custom_constraint"
  #   type: "inequality"
  #   expression: "custom_expression"

# Objective configuration
objective:
  type: "minimize"
  function: "tax_liability"  # Options: 'tax_liability', 'capital_gains', 'custom'
  description: "Minimize total capital gains tax liability"
  # For custom objective, provide expression:
  # expression: "sum(short_term_gains * 0.37 + long_term_gains * 0.20)"

# In your optimizer_params in config file:
optimizer_params:
  solver: "APOPT"           # Solver: APOPT (1), BPOPT (2), IPOPT (3)
  verbose: true             # Print solver output
  remote: false             # Use local solver

  # GEKKO options that work:
  IMODE: 3                  # Steady-state optimization
  MAX_ITER: 100             # Maximum iterations
  MAX_TIME: 600             # Maximum time in seconds
  OTOL: 1.0e-6             # Objective function tolerance
  RTOL: 1.0e-6             # Equation solution tolerance
  COLDSTART: 0              # 0=warm start, 1=cold start, 2=decompose
  SENSITIVITY: 0            # 0=off, 1=on

  # APOPT-specific (if using APOPT solver):
  APOPT.MINLP_MAX_ITER: 1000     # Max iterations for MINLP
  APOPT.MINLP_GAP_TOL: 0.01      # Optimality gap tolerance (this is the real MIP gap!)

# Tax Parameters
tax_parameters:
  short_term_cg_rate: 0.37
  long_term_cg_rate: 0.20
  ordinary_income_offset_limit: 3000
  long_term_threshold_days: 365
  valuation_date: "2025-01-15"

# Output settings
output:
  save_results: true
  formats: ["json", "csv"]
  include_metadata: true

# Additional metadata
metadata:
  client_name: "Sample Client"
  portfolio_type: "Individual Taxable Account"
  optimization_date: "2025-01-15"
  analyst: "Portfolio Optimization Team"
  notes: "Tax-loss harvesting with ST/LT consideration"

# Base path for outputs and logs
base_path: "."