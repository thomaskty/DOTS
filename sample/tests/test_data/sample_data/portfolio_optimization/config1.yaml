# Portfolio Optimization Configuration
# Tax-efficient stock liquidation with short-term/long-term capital gains

name: "stock_liquidation_optimization"
description: "Minimize capital gains tax when liquidating stock portfolio considering ST/LT rates and loss offsetting"

# Playbook configuration
playbook_type: "portfolio_optimization"

# Optimizer settings
optimizer_type: "milp"

# In your optimizer_params in config file:
optimizer_params:
  solver: "APOPT"           # Solver: APOPT (1), BPOPT (2), IPOPT (3)
  verbose: true             # Print solver output
  remote: false             # Use local solver

  # GEKKO options that work:
  IMODE: 3                  # Steady-state optimization
  MAX_ITER: 100             # Maximum iterations
  MAX_TIME: 600             # Maximum time in seconds
  OTOL: 1.0e-6             # Objective function tolerance
  RTOL: 1.0e-6             # Equation solution tolerance
  COLDSTART: 0              # 0=warm start, 1=cold start, 2=decompose
  SENSITIVITY: 0            # 0=off, 1=on

  # APOPT-specific (if using APOPT solver):
  APOPT.MINLP_MAX_ITER: 1000     # Max iterations for MINLP
  APOPT.MINLP_GAP_TOL: 0.01      # Optimality gap tolerance (this is the real MIP gap!)

# Input data files (relative to input_data_path)
input_data_path: "tests/test_data/sample_data/portfolio_optimization"
holdings_file: "holdings.csv"
purchase_history_file: "purchase_history.csv"

# Output settings
# output_dir will be auto-generated as: <project_parent>/outputs/<name>
# e.g., /path/to/pycharmProjects/app/outputs/stock_liquidation_optimization/
save_results: true

# Tax Parameters (Metadata)
metadata:
  # Capital gains tax rates
  short_term_cg_rate: 0.37    # 37% for holdings < 1 year
  long_term_cg_rate: 0.20     # 20% for holdings >= 1 year

  # Loss offsetting rules
  ordinary_income_offset_limit: 3000  # Max capital loss that can offset ordinary income

  # Valuation date (for calculating holding periods)
  valuation_date: "2025-01-15"

  # Client information
  client_name: "Sample Client"
  optimization_date: "2025-01-15"

# Base path for outputs and logs
base_path: "."